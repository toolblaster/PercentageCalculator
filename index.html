<!--
VERSION: Evergreen v1.0
This tool is intentionally feature-stable.
Do not redesign unless functionality breaks.
Last structural update: 2026
-->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- BRANDING: Updated Meta Description -->
<meta name="description" content="A fast, free percentage calculator with real-time results. Calculate percentage values, increases, decreases, differences, and reverse percentages instantly — no buttons, no login, no data tracking.">
<!-- BRANDING: Added Canonical URL -->
<link rel="canonical" href="https://percentagecalculator.toolblaster.com/">

<!-- SOCIAL: Open Graph Meta Tags -->
<meta property="og:title" content="Percentage Calculator – Fast Increase, Decrease & Comparison Calculations">
<meta property="og:description" content="A fast, free percentage calculator with real-time results. Calculate percentage values, increases, decreases, differences, and reverse percentages instantly.">
<meta property="og:url" content="https://percentagecalculator.toolblaster.com/">
<meta property="og:site_name" content="ToolBlaster">
<meta property="og:type" content="website">

<!-- BRANDING: Favicons -->
<link rel="apple-touch-icon" href="favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="48x48" href="favicon/favicon-48x48.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
<link rel="manifest" href="favicon/site.webmanifest">

<!-- FONTS: Inter (Optimized Loading) -->
<!-- CLS FIX: Use preload and non-blocking swap to prevent layout shift -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" media="print" onload="this.media='all'">
<noscript>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
</noscript>

<!-- TASK 2: Improve Title Tag -->
<title>Percentage Calculator – Fast Increase, Decrease & Comparison Calculations</title>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "WebPage",
      "name": "Percentage Calculator",
      "description": "A fast, free percentage calculator with real-time results. Calculate percentage values, increases, decreases, differences, and reverse percentages instantly — no buttons, no login, no data tracking.",
      "url": "https://percentagecalculator.toolblaster.com/",
      "inLanguage": "en",
      "publisher": {
        "@type": "Organization",
        "name": "ToolBlaster",
        "url": "https://toolblaster.com/"
      }
    },
    {
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "How do I calculate a percentage increase?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Subtract the original number from the new number, divide the result by the original number, and then multiply by 100."
          }
        },
        {
          "@type": "Question",
          "name": "How do I find X percent of Y?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Divide the percentage (X) by 100 and multiply it by the number (Y). For example, 20% of 50 is (20/100) * 50 = 10."
          }
        },
        {
          "@type": "Question",
          "name": "What is the percentage difference formula?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "In this calculator, percentage difference is calculated by dividing the absolute difference between two values by their average ((A + B) / 2) and multiplying by 100."
          }
        },
        {
          "@type": "Question",
          "name": "Is this calculator free to use?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. This tool is completely free and runs entirely in your browser."
          }
        }
      ]
    }
  ]
}
</script>
<script type="application/ld+json">
{
 "@context": "https://schema.org",
 "@type": "WebApplication",
 "name": "Percentage Calculator",
 "applicationCategory": "UtilitiesApplication",
 "operatingSystem": "Any",
 "description": "Free online percentage calculator for increases, decreases, comparisons, and reverse calculations.",
 "offers": {
   "@type": "Offer",
   "price": "0"
 }
}
</script>
<style>
  /* CLS FIX: Global Defaults for Stability */
  html {
    font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    font-synthesis-weight: none;
    -webkit-font-smoothing: antialiased;
  }
  img, svg {
    max-width: 100%;
    height: auto;
    display: block;
  }

  :root {
    --bg-body: #f8fafc; /* Lighter, cleaner slate background */
    --bg-card: rgba(255, 255, 255, 0.9); /* Glassy card bg */
    --text-main: #0f172a; /* Slate 900 - Darker, sharper text */
    --text-muted: #334155; /* Slate 700 - WCAG Compliant (4.5:1+ against #f8fafc) */
    --border: #cbd5e1; /* Slate 300 - Slightly darker border for better visibility */
    
    /* MODERN SAAS PURPLE/INDIGO THEME - HIGH CONTRAST */
    --primary: #4338ca; /* Indigo 700 - Darker for better contrast against light bg */
    --primary-hover: #3730a3; /* Indigo 800 */
    --primary-bg: #e0e7ff; /* Indigo 100 - Slightly darker bg for better contrast with text */
    --primary-light: #6366f1; /* Indigo 500 */
    
    --radius: 12px; /* Slightly reduced radius for tighter look */
    --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;

    /* VISUAL ACCENTS: More vibrant, unified palette - High Contrast Versions */
    --accent-1: #4338ca; /* Indigo 700 */
    --accent-2: #0369a1; /* Sky 700 */
    --accent-3: #7c3aed; /* Violet 600 */
    --accent-4: #059669; /* Emerald 600 */
    --accent-5: #d97706; /* Amber 600 */
    --accent-6: #db2777; /* Pink 600 */
    
    /* SHADOWS */
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --shadow-glow: 0 0 20px rgba(67, 56, 202, 0.15);
  }
  
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  
  body { 
    font-family: var(--font-sans); 
    background: var(--bg-body); 
    /* Subtle mesh gradient background */
    background-image: 
        radial-gradient(at 0% 0%, rgba(67, 56, 202, 0.03) 0px, transparent 50%),
        radial-gradient(at 100% 0%, rgba(3, 105, 161, 0.03) 0px, transparent 50%);
    background-attachment: fixed;
    color: var(--text-main); 
    line-height: 1.4; /* Tighter line height */
    font-size: 13px; /* Slightly smaller base font */
    display: flex; 
    flex-direction: column; 
    min-height: 100vh; 
  }

  /* Breadcrumbs */
  .breadcrumb {
    font-size: 0.75rem; /* Smaller font */
    color: var(--text-muted);
    margin-bottom: 0.5rem; /* Reduced margin */
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }
  .breadcrumb a {
    color: var(--text-muted);
    text-decoration: none;
    transition: color 0.2s;
  }
  .breadcrumb a:hover {
    color: var(--primary);
    text-decoration: underline;
  }
  .breadcrumb span {
    color: var(--text-main);
    font-weight: 500;
  }
  .breadcrumb .separator {
    color: #64748b; /* Slate 500 - Visible separator */
    font-size: 0.8em;
  }

  /* V3: Ad Placeholder Styles (CLS Safe) */
  .ad-slot {
    width: 100%;
    max-width: 1140px;
    display: none; 
    min-height: 80px; /* Reduced min-height */
    overflow: hidden; 
    background: transparent;
    border: none;
    border-radius: var(--radius);
    align-items: center;
    justify-content: center;
    color: var(--text-muted); 
    font-size: 0.8rem;
  }
  .ad-slot.top { margin-bottom: 0; }
  .ad-slot.bottom { margin-top: 0.5rem; }

  /* TASK 0: Make Header Static */
  header { 
    background: rgba(255, 255, 255, 0.95); /* More opaque for contrast */
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.08); /* Slightly darker border */
    padding: 0.5rem 0; /* Minimized padding */
    margin-bottom: 0.75rem; /* Reduced margin */
    margin-top: 0;
    box-shadow: var(--shadow-sm);
    /* Removed sticky and top:0 */
    position: relative;
    z-index: 1;
  }
  .container { 
    max-width: 1140px; 
    margin: 0 auto; 
    padding: 0 1rem; /* Reduced padding */
  }

  /* Updated Header Layout: Flex Row for Logo */
  .header-top-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.2rem;
  }
  
  /* Logo + H1 Combined */
  .brand-wrapper {
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }
  .brand-icon {
    width: 32px; /* Increased from 26px */
    height: 32px;
    color: white;
    /* Gradient Brand Icon - Higher contrast start/end */
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    padding: 6px; /* Increased padding slightly for larger icon */
    border-radius: 8px; /* Slightly larger radius */
    box-shadow: 0 2px 4px rgba(67, 56, 202, 0.25);
  }
  header h1 { 
    font-size: 1.25rem; /* Increased size to match larger icon visual weight */
    font-weight: 800; 
    letter-spacing: -0.02em;
    margin: 0;
    line-height: 1.1;
    /* Gradient Text - Darker colors */
    background: linear-gradient(to right, var(--text-main), #334155);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Description under H1 */
  .header-desc {
    font-size: 0.8rem; /* Smaller desc */
    color: var(--text-muted);
    max-width: 700px; 
    margin: 0;
    line-height: 1.3;
    font-weight: 500; /* Increased weight */
    /* Align with text start (icon width 32px + gap 0.6rem approx 9.6px + slight offset) */
    margin-left: calc(32px + 0.6rem); 
  }

  /* NEW: Context Strip Styles (H2) */
  .context-strip {
    font-size: 0.8rem;
    font-weight: 500; /* Medium weight, not bold */
    color: var(--text-muted);
    padding: 6px 0 10px 0;
    border-bottom: 1px solid var(--border);
    margin: 0 0 10px 0; /* Reset H2 default margins */
    text-align: center; /* Centered Text */
  }

  main { padding-bottom: 1.5rem; flex: 1; }

  /* Grid Layout */
  .grid { 
    display: grid; 
    grid-template-columns: 1fr; 
    gap: 0.75rem; /* Tighter gap */
    min-height: 480px; /* Reduced reserved height */
    align-items: start; 
  }
  @media (min-width: 640px) { 
    .grid { grid-template-columns: 1fr 1fr; } 
  }
  @media (min-width: 1024px) { 
    .grid { grid-template-columns: repeat(3, 1fr); } 
  }

  /* Card Component - COMPACT & PREMIUM */
  .card { 
    /* Glassmorphism background */
    background: var(--bg-card);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);

    /* Subtle border - Darker for visibility */
    border: 1px solid rgba(226, 232, 240, 0.8);
    /* Top accent border is removed in favor of internal accents or left as subtle indicator */
    border-top: 3px solid var(--card-accent, var(--primary)); 
    border-radius: var(--radius);

    /* Deep Shadow */
    box-shadow: var(--shadow-md);

    display: flex; 
    flex-direction: column; 
    height: fit-content;
    
    /* Removed hover transition */
  }
  
  /* Assign accents based on position */
  .card:nth-child(1) { --card-accent: var(--accent-1); }
  .card:nth-child(2) { --card-accent: var(--accent-2); }
  .card:nth-child(3) { --card-accent: var(--accent-3); }
  .card:nth-child(4) { --card-accent: var(--accent-4); }
  .card:nth-child(5) { --card-accent: var(--accent-5); }
  .card:nth-child(6) { --card-accent: var(--accent-6); }
  
  .card-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    padding: 0.6rem 0.85rem; /* Minimized padding */
    border-bottom: 1px solid var(--border);
    background: rgba(241, 245, 249, 0.7); /* Slightly darker header bg */
    border-top-left-radius: var(--radius);
    border-top-right-radius: var(--radius);
  }
  .card-header h2 { 
    font-size: 0.85rem; 
    font-weight: 700; 
    color: var(--text-main);
    margin: 0;
    letter-spacing: -0.01em;
  }
  
  .reset-btn { 
    background: transparent; 
    border: none; 
    cursor: pointer; 
    color: #64748b; /* Darker grey */
    padding: 4px; 
    border-radius: 4px; 
    display: flex; 
    align-items: center; 
    transition: all 0.2s; 
  }
  .reset-btn:hover { 
    color: var(--text-main); 
    background: #e2e8f0; 
  }
  .reset-btn svg { width: 13px; height: 13px; }

  /* Card Body */
  .card-body { 
    padding: 0.85rem; /* Minimized padding */
    display: grid; 
    grid-template-columns: 1fr; 
    gap: 0.5rem; /* Tighter gap */
    align-content: start;
  }
  @media (min-width: 640px) {
    .card-body { 
        grid-template-columns: 1fr 1fr; 
    }
    .result-wrapper, .try-example, details.history, .explain-section { grid-column: 1 / -1; }
  }

  /* Input Fields */
  .field label { 
    display: block; 
    font-size: 0.7rem; /* Smaller labels */
    text-transform: uppercase;
    letter-spacing: 0.03em;
    color: var(--text-muted); /* Using darker muted color */
    margin-bottom: 0.2rem; 
    font-weight: 700; /* Increased weight for legibility */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .field input { 
    width: 100%; 
    height: 32px; /* Very compact inputs */
    padding: 0 0.5rem; 
    border: 1px solid var(--border); 
    border-radius: 6px; 
    font-size: 0.85rem; 
    background: #fff; 
    outline: none; 
    transition: border-color 0.15s, box-shadow 0.15s;
    -moz-appearance: textfield;
    color: var(--text-main);
    font-weight: 500;
  }
  .field input::-webkit-outer-spin-button,
  .field input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  .field input:focus { 
    border-color: var(--primary); 
    box-shadow: 0 0 0 2px rgba(67, 56, 202, 0.15); /* Slightly smaller shadow */
  }
  .field input::placeholder { color: #475569; /* Slate 600 - High contrast placeholder */ opacity: 1; }

  /* Mobile Input Optimization - Keep usable size */
  @media (max-width: 640px) {
    .field input {
      height: 40px; 
      font-size: 16px; 
    }
  }

  /* Result Wrapper & Copy Button */
  .result-wrapper {
    display: flex;
    gap: 0.5rem;
    align-items: stretch;
    margin-top: 0.25rem;
  }

  .result { 
    flex: 1;
    padding: 0.25rem 0.5rem;
    border-radius: 6px; 
    text-align: center; 
    font-size: 0.9rem; 
    font-weight: 700; 
    min-height: 32px; /* Compact result */
    display: flex;
    align-items: center;
    justify-content: center;
    word-break: break-word;
    transition: all 0.3s ease;
    
    /* Default empty state */
    background: #f1f5f9; 
    color: var(--text-muted); 
    border: 1px dashed var(--border);
  }
  
  .result.filled { 
    background: var(--primary-bg); 
    color: var(--primary); 
    border: 1px solid rgba(67, 56, 202, 0.2);
  }
  
  @media (max-width: 640px) {
    .result { min-height: 40px; } 
  }

  @keyframes highlight-pulse {
    0% { background-color: #c7d2fe; transform: scale(1.02); }
    100% { background-color: var(--primary-bg); transform: scale(1); }
  }
  .result.updated { animation: highlight-pulse 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

  .copy-btn {
    width: 32px; 
    display: flex;
    align-items: center;
    justify-content: center;
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 6px;
    cursor: pointer;
    color: var(--text-muted);
    transition: all 0.2s;
  }
  .copy-btn:hover { 
    background: #f8fafc; 
    color: var(--primary); 
    border-color: var(--primary); 
  }
  .copy-btn:active { transform: translateY(1px); }
  .copy-btn svg { width: 14px; height: 14px; }
  
  @media (max-width: 640px) {
    .copy-btn { width: 40px; }
  }

  /* TASK 4: CSS for "Copy Number Only" Button */
  .copy-number-btn {
    width: 32px;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: #fff;
    font-size: 0.75rem;
    font-weight: 700;
    cursor: pointer;
    color: var(--text-muted);
    transition: all 0.2s;
  }
  .copy-number-btn:hover {
    color: var(--primary);
    border-color: var(--primary);
  }

  /* NEW: Explanation Styles */
  .explain-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 0.75rem;
    text-decoration: underline;
    cursor: pointer;
    margin-top: 0.25rem;
    padding: 0;
    display: none; /* Hidden by default until result exists */
    width: fit-content;
  }
  .explain-btn:hover { color: var(--primary); }
  
  .explanation-box {
      display: none;
      margin-top: 0.5rem;
      padding: 0.75rem;
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 0.75rem;
      font-family: 'Inter', monospace;
      color: var(--text-main);
      white-space: pre-wrap;
      line-height: 1.5;
  }
  .explanation-box.visible { display: block; }

  /* Try Example Section - NEW FEATURE */
  .try-example {
    grid-column: 1 / -1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 8px; /* Tighter padding */
    border: 1px dashed var(--border);
    border-radius: 6px;
    font-size: 0.7rem;
    background: rgba(248, 250, 252, 0.9);
    color: var(--text-muted);
    margin-top: 0.15rem;
  }
  .try-example button {
    border: none;
    background: none;
    color: var(--primary);
    cursor: pointer;
    font-size: 0.7rem;
    font-weight: 700; /* Bold for readability */
    padding: 2px 4px;
    border-radius: 4px;
  }
  .try-example button:hover {
    text-decoration: underline;
  }

  /* History Section */
  details.history {
    font-size: 0.7rem; 
    color: var(--text-muted);
    border-top: 1px solid var(--border);
    padding-top: 0.35rem; 
    margin-top: 0.15rem;
  }
  summary {
    cursor: pointer;
    list-style: none;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.2rem;
    user-select: none;
    color: var(--text-muted);
    transition: color 0.2s;
  }
  summary:hover { color: var(--primary); }
  summary::-webkit-details-marker { display: none; }
  summary::before {
    content: '';
    display: inline-block;
    width: 0; 
    height: 0; 
    border-top: 3px solid transparent; /* Smaller arrow */
    border-bottom: 3px solid transparent;
    border-left: 4px solid currentColor;
    margin-right: 3px;
    transition: transform 0.2s;
  }
  details[open] summary::before { transform: rotate(90deg); }
  
  .history-list {
    list-style: none;
    padding-top: 0.25rem;
    /* Removed animation fadeIn */
  }
  .history-list li {
    padding: 0.2rem 0; 
    border-bottom: 1px dashed var(--border);
    display: flex;
    justify-content: space-between;
  }
  .history-list li:last-child { border-bottom: none; }
  .history-val { 
    color: var(--text-main); 
    font-family: monospace; 
    font-weight: 500; 
    background: rgba(0,0,0,0.03);
    padding: 0 4px;
    border-radius: 4px;
  }
  
  /* Removed @keyframes fadeIn */

  /* V3: Footer, Trust Signals & FAQ */
  footer { 
    border-top: 1px solid var(--border); 
    margin-top: auto; 
    background: #fff;
    /* CLS FIX: Prevent footer from collapsing/jumping before content loads */
    min-height: 400px;
    contain: content;
  }
  /* Adjusted top padding to separate from content above */
  footer .container { padding-top: 1.5rem; padding-bottom: 1.5rem; }

  /* Footer Bottom Section */
  .footer-bottom-section {
    background-color: #f8fafc; 
    border-top: 1px solid var(--border);
    padding: 1.5rem 0; /* Reduced padding */
    width: 100%;
    margin-top: 0;
  }
  
  /* NEW: Evergreen Note */
  .evergreen-note {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-align: center;
    margin-bottom: 6px;
  }

  /* UPDATED: Plain text trust bar */
  .trust-bar {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
    text-align: center;
    font-weight: 500;
    opacity: 0.9;
  }

  /* Knowledge Strip Styles */
  .knowledge-strip {
    padding: 1.5rem 0;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    background: linear-gradient(to right, #f8fafc, #f1f5f9, #f8fafc);
    margin-bottom: 2rem;
    text-align: center;
  }
  .knowledge-strip h2 {
    font-size: 1rem; 
    font-weight: 700;
    color: var(--text-main);
    margin-bottom: 0.5rem;
  }
  .knowledge-strip p {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 0.75rem;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.5;
  }
  .text-link {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.85rem;
    padding-bottom: 1px;
    border-bottom: 2px solid transparent;
    transition: border-color 0.2s;
  }
  .text-link:hover { text-decoration: none; border-bottom-color: var(--primary-light); }
  
  /* Internal links styling in SEO text */
  .seo-link { 
    color: var(--text-main); 
    text-decoration: underline; 
    text-decoration-color: var(--primary-light); 
    text-decoration-thickness: 2px;
    text-underline-offset: 2px;
  }
  .seo-link:hover { color: var(--primary); background: var(--primary-bg); }

  /* Educational Formulas Section */
  .formulas-section {
    margin: 1.5rem auto;
    padding: 1.25rem;
    max-width: 1000px;
    background: #fff;
    border-radius: 12px;
    border: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
  }
  .formulas-section h2 {
    text-align: center;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-main);
    margin-bottom: 1rem;
  }
  .formula-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  @media (min-width: 768px) {
    .formula-grid { grid-template-columns: 1fr 1fr; }
  }
  .formula-item {
    background: #f8fafc;
    padding: 1rem;
    border-radius: 10px;
    border: 1px solid var(--border);
    /* Removed transition and hover effect */
  }
  .formula-item h3 {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 0.35rem;
  }
  .formula-item p {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    line-height: 1.4;
  }
  .formula-box {
    background: #fff;
    padding: 0.5rem;
    border-radius: 6px;
    border: 1px solid var(--border);
    margin-top: 0.35rem;
    font-size: 0.75rem;
    line-height: 1.5;
    color: var(--text-main);
    font-family: monospace;
    display: block;
  }

  /* About Section */
  .about-section {
    max-width: 900px;
    margin: 0 auto 2rem auto; 
    padding: 1.5rem;
    background: #fff;
    border-radius: 12px;
    border: 1px solid var(--border);
    text-align: center;
    box-shadow: var(--shadow-sm);
  }
  .about-section h2 {
    font-size: 1.1rem;
    font-weight: 800;
    color: var(--text-main);
    margin-bottom: 0.5rem; 
  }
  .about-section p {
    font-size: 0.85rem;
    color: var(--text-muted);
    line-height: 1.5;
    margin-bottom: 0.75rem;
  }
  
  .instant-note {
    font-weight: 600;
    color: var(--primary);
    font-size: 0.9rem;
    margin-bottom: 0.75rem;
    display: block;
  }
  
  .feature-title {
    font-weight: 700;
    color: var(--text-main);
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }
  .feature-list {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.35rem 0.75rem;
    text-align: left;
    max-width: 420px;
    margin: 0 auto;
    padding: 0;
    list-style: none;
    font-size: 0.85rem;
    color: var(--text-muted);
  }
  .feature-list li {
    display: flex;
    align-items: center;
    padding: 0.15rem 0;
  }
  .feature-list li::before {
    content: "•";
    color: var(--primary);
    margin-right: 0.5rem;
    font-size: 1.2em;
    line-height: 1;
  }
  @media (min-width: 640px) {
    .feature-list { grid-template-columns: 1fr 1fr; }
  }

  .faq-section {
    margin-bottom: 2rem;
    max-width: 900px; 
    margin-left: auto;
    margin-right: auto;
    border-top: 1px solid var(--border);
    padding-top: 2rem;
  }
  .faq-section h2 { font-size: 1.1rem; font-weight: 800; color: var(--text-main); margin-bottom: 1rem; padding-bottom: 0.5rem; }
  .faq-item { margin-bottom: 1rem; }
  .faq-item h3 { font-size: 0.9rem; font-weight: 700; color: var(--text-main); margin-bottom: 0.35rem; }
  .faq-item p { font-size: 0.85rem; line-height: 1.5; color: var(--text-muted); margin: 0; }

  /* Shared Button Style (Used in Footer) */
  .share-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    background: white;
    border: 1px solid var(--border);
    color: var(--text-main);
    padding: 0 14px; /* Reduced padding */
    border-radius: 20px; /* Pill shape */
    font-size: 0.75rem; 
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    height: 32px; /* Reduced height */
    margin: 0 auto;
    box-shadow: var(--shadow-sm);
  }
  .share-btn:hover {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: white;
    border-color: transparent;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(67, 56, 202, 0.25);
  }
  .share-btn:active { transform: translateY(0); }
  .share-btn svg { width: 13px; height: 13px; }

  .footer-links {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    font-size: 0.85rem;
  }
  .affiliate-link { color: var(--text-muted); }
  .affiliate-link a { color: var(--text-muted); text-decoration: underline; }

  footer p.copyright { text-align: center; font-size: 0.75rem; color: var(--text-muted); }
</style>
</head>
<body>

<!-- V3: Top Ad Slot (CLS Safe - No Text) -->
<div class="container">
  <!-- LOCKED AD SPACE - PRESERVED: Added role="region" to generic div with aria-label -->
  <div class="ad-slot top" role="region" aria-label="Advertisement"></div>
</div>

<header>
  <div class="container">
    <div class="header-top-row">
      <div class="brand-wrapper">
        <!-- 2-in-1 Logo: Icon + H1 Text -->
        <svg class="brand-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 4.5l-15 15m0 0h.01M19.5 4.5h.01M6 9a3 3 0 110-6 3 3 0 010 6zm12 12a3 3 0 110-6 3 3 0 010 6z" />
        </svg>
        <h1>Percentage Calculator</h1>
      </div>
      <!-- Share Button Moved to Footer -->
    </div>
    <!-- UPDATED: Description removed per request -->
  </div>
</header>

<main>
  <div class="container">
    <!-- NEW: Context Strip (H2 Heading) -->
    <h2 class="context-strip">
        Universal percentage calculator — compare change, find original value, compare two numbers.
    </h2>
    <div class="grid" id="grid"></div>
  </div>
</main>

<footer>
  <div class="container">
    <!-- About Section (Moved to Top) -->
    <div class="about-section">
      <h2>Free Online Percentage Tools</h2>
      <p class="instant-note">Results update instantly as you type — no calculate button required.</p>
      <p>Designed for fast workflows on laptops and desktops, while remaining mobile-friendly.</p>
      <p>Use this free online percentage calculator to instantly solve common math problems. Whether you need to determine percentage increases for analysis, calculate the percentage difference between two numbers, or figure out what percentage X is of Y, this tool delivers accurate results in real-time. Your inputs and recent calculations are saved locally in your browser for convenience.</p>
      
      <!-- Feature List REPLACED -->
      <p style="margin-top: 1rem; color: var(--text-muted);">Supports increases, decreases, comparisons, and reverse calculations.</p>
    </div>

    <!-- NEW: Knowledge Strip -->
    <section class="knowledge-strip">
      <h2>Want to understand how percentage calculations work?</h2>
      <p>
        Learn percentage formulas for increase, decrease, difference,
        reverse percentage, and step-by-step examples in our complete guide.
      </p>
      <a href="pages/percentage-guide.html" class="text-link">
        Learn Percentages – Complete Guide →
      </a>
    </section>

    <!-- New: How Calculations Work Section -->
    <div class="formulas-section">
      <h2>How Calculations Work</h2>
      <div class="formula-grid">
        <div class="formula-item">
          <h3>Find a Percentage of a Number</h3>
          <p>Use this to find a specific portion of a total. For example, if you are buying a laptop for $1000 and the sales tax is 8%, this calculates the exact tax amount ($80).</p>
          <div class="formula-box">
            Formula: (Percentage ÷ 100) × Total Number<br>
            Example: 20% of 100<br>
            Calculation: (20 ÷ 100) × 100 = 20
          </div>
        </div>
        <div class="formula-item">
          <h3>Find What Percentage X is of Y</h3>
          <p>Use this to see what fraction one number represents of a larger whole. For instance, if you scored 42 questions correct out of 50, this calculates the final grade percentage (84%).</p>
          <div class="formula-box">
            Formula: (Part ÷ Whole) × 100<br>
            Example: 10 is what % of 50?<br>
            Calculation: (10 ÷ 50) × 100 = 20%
          </div>
        </div>
        <div class="formula-item">
          <h3>Find the Total Given a Percentage</h3>
          <p>Use this to calculate the original whole number when you only know a part and its percentage rate. Learn more about <a href="pages/percentage-guide.html" class="seo-link">reverse percentage</a> calculations.</p>
          <div class="formula-box">
            Formula: Part ÷ (Percentage ÷ 100)<br>
            Example: If 10 is 20%...<br>
            Calculation: 10 ÷ 0.20 = 50
          </div>
        </div>
        <div class="formula-item">
          <h3>Calculate Percentage Increase</h3>
          <p>Use this to measure how much a number has grown. Great for calculating salary raises or rent increases. See our guide on <a href="pages/percentage-guide.html" class="seo-link">percentage increase</a>.</p>
          <div class="formula-box">
            Formula: ((New Value - Old Value) ÷ Old Value) × 100<br>
            Example: 100 to 150<br>
            Calculation: ((150 - 100) ÷ 100) × 100 = 50%
          </div>
        </div>
        <div class="formula-item">
          <h3>Calculate Percentage Decrease</h3>
          <p>Use this to measure how much a number has dropped from its starting value. Perfect for figuring out the markdown percentage during a store sale or asset depreciation.</p>
          <div class="formula-box">
            Formula: ((Old Value - New Value) ÷ Old Value) × 100<br>
            Example: 100 to 75<br>
            Calculation: ((100 - 75) ÷ 100) × 100 = 25%
          </div>
        </div>
        <!-- REFINED: Updated description to match the "relative to B" logic -->
        <div class="formula-item">
          <h3>Calculate Percentage Difference</h3>
          <p>In this tool, this is calculated by dividing the absolute difference between two values by their average. Use this when comparing two values where neither is the "standard" or "original". Check the percentage difference formula.</p>
          <div class="formula-box">
            Formula: |A - B| ÷ ((A + B) / 2) × 100<br>
            Example: 50 (A) vs 40 (B)<br>
            Calculation: |50 - 40| ÷ ((50 + 40) / 2) × 100 = 22.2222%
          </div>
        </div>
      </div>
    </div>

    <!-- SEO FAQ -->
    <div class="faq-section">
      <h2>Frequently Asked Questions</h2>
      <div class="faq-item">
        <h3>1. How do I calculate a percentage increase?</h3>
        <p>Subtract the original number from the new number, divide the result by the original number, and then multiply by 100.</p>
      </div>
      <div class="faq-item">
        <h3>2. How do I find X percent of Y?</h3>
        <p>Divide the percentage (X) by 100 and multiply it by the number (Y). For example, 20% of 50 is (20/100) * 50 = 10.</p>
      </div>
      <div class="faq-item">
        <h3>3. What is the percentage difference formula?</h3>
        <!-- REFINED: Updated answer to clarify "relative to second value" logic -->
        <p>In this calculator, percentage difference is calculated by dividing the absolute difference between two values by their average ((A + B) / 2) and multiplying by 100.</p>
      </div>
      <div class="faq-item">
        <h3>4. Is this calculator free to use?</h3>
        <p>Yes. This tool is completely free and runs entirely in your browser.</p>
      </div>
    </div>
  </div><!-- End Main Footer Content Container -->

  <!-- NEW: Visually Distinct Bottom Footer Area -->
  <div class="footer-bottom-section">
    <div class="container">
        <!-- Share & Affiliate -->
        <div class="footer-links">
          <!-- Added Navigation Links: Pointing to pages folder -->
          <div style="margin-top: 0.5rem;">
            <a href="pages/about.html" style="color: var(--text-muted); text-decoration: none; margin: 0 0.5rem;">About</a>
            <a href="pages/privacy.html" style="color: var(--text-muted); text-decoration: none; margin: 0 0.5rem;">Privacy</a>
          </div>
          
          <!-- New subtle footer knowledge link -->
          <a href="pages/percentage-guide.html" style="color: var(--text-muted); text-decoration: none; font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.8;">Learn percentage formulas & step-by-step explanations →</a>
        </div>

        <!-- BRANDING: Updated Footer Copyright with clickable brand link -->
        <p class="copyright">&copy; 2026 percentagecalculator.<a href="https://toolblaster.com" style="color: inherit; text-decoration: underline;">Toolblaster.com</a> &middot; Free online Percentage calculation tools</p>
        
        <!-- Footer End Actions -->
        <div class="footer-end-actions" style="margin-top: 1.5rem; text-align: center;">
          <!-- NEW: Evergreen Note -->
          <div class="evergreen-note">
            This tool is intentionally simple and will remain free and unchanged.
          </div>

          <!-- Trust Signals -->
          <div class="trust-bar">
            No login required &middot; Works offline &middot; No data is stored or tracked
          </div>
          
          <!-- Share Button -->
          <button class="share-btn" id="shareBtn" aria-label="Share tool">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
            <span>Share</span>
          </button>
        </div>
    </div>
  </div>
</footer>

<!-- Bottom Ad Slot (CLS Safe) -->
<div class="container">
  <!-- LOCKED AD SPACE - PRESERVED: Added role="region" to generic div with aria-label -->
  <div class="ad-slot bottom" role="region" aria-label="Advertisement"></div>
</div>

<script>
// V2: Storage Key Prefix
const STORE_KEY = 'pcalc_v2_';
// TASK 5: URL State Sharing Variable
let userInteracted = false;

// TASK 3: Fix Rounding Logic
// Centralized formatting logic for consistency
const formatNum = (num) => {
  if (Number.isInteger(num)) return num;
  return parseFloat(num.toFixed(4));
};

const calcs = [
  { 
    title: "What is X% of Y?", 
    slug: "percentage-of-number",
    a: "Percentage (%)", b: "Number", pa: "15", pb: "200",
    fn: (a, b) => `${a}% of ${b} = ${formatNum(a / 100 * b)}`,
    explain: (a, b) => {
        const dec = a/100;
        return `Step 1: Convert percentage to decimal\n${a} ÷ 100 = ${formatNum(dec)}\n\nStep 2: Multiply by number\n${formatNum(dec)} × ${b} = ${formatNum(dec*b)}`;
    }
  },
  { 
    title: "X is what % of Y?", 
    slug: "percent-of-total",
    a: "Part (X)", b: "Whole (Y)", pa: "30", pb: "200",
    fn: (a, b) => b === 0 ? "Cannot divide by zero" : `${a} is ${formatNum(a / b * 100)}% of ${b}`,
    explain: (a, b) => {
        if(b===0) return 'Cannot divide by zero.';
        const ratio = a/b;
        return `Step 1: Divide part by whole\n${a} ÷ ${b} = ${formatNum(ratio)}\n\nStep 2: Multiply by 100\n${formatNum(ratio)} × 100 = ${formatNum(ratio*100)}%`;
    }
  },
  { 
    title: "If X is N%, find Total", 
    slug: "reverse-percentage",
    a: "Value (X)", b: "Percentage (N%)", pa: "30", pb: "15",
    fn: (a, b) => b === 0 ? "Percentage cannot be zero" : `If ${a} is ${b}%, total = ${formatNum(a / b * 100)}`,
    explain: (a, b) => {
        if(b===0) return 'Percentage cannot be zero.';
        const dec = b/100;
        return `Step 1: Convert percentage to decimal\n${b} ÷ 100 = ${formatNum(dec)}\n\nStep 2: Divide value by decimal\n${a} ÷ ${formatNum(dec)} = ${formatNum(a/dec)}`;
    }
  },
  { 
    title: "Percentage Increase", 
    slug: "percentage-increase",
    a: "Original value", b: "New value", pa: "100", pb: "150",
    fn: (a, b) => a === 0 ? "Original value cannot be zero" : `${a} → ${b} = ${formatNum((b - a) / a * 100)}% increase`,
    explain: (a, b) => {
        if(a===0) return 'Original value cannot be zero.';
        const diff = b - a;
        const ratio = diff / a;
        return `Step 1: Find the difference\n${b} - ${a} = ${formatNum(diff)}\n\nStep 2: Divide by original value\n${formatNum(diff)} ÷ ${a} = ${formatNum(ratio)}\n\nStep 3: Multiply by 100\n${formatNum(ratio)} × 100 = ${formatNum(ratio*100)}%`;
    }
  },
  { 
    title: "Percentage Decrease", 
    slug: "percentage-decrease",
    a: "Original value", b: "New value", pa: "150", pb: "100",
    fn: (a, b) => a === 0 ? "Original value cannot be zero" : `${a} → ${b} = ${formatNum((a - b) / a * 100)}% decrease`,
    explain: (a, b) => {
        if(a===0) return 'Original value cannot be zero.';
        const diff = a - b;
        const ratio = diff / a;
        return `Step 1: Find the difference\n${a} - ${b} = ${formatNum(diff)}\n\nStep 2: Divide by original value\n${formatNum(diff)} ÷ ${a} = ${formatNum(ratio)}\n\nStep 3: Multiply by 100\n${formatNum(ratio)} × 100 = ${formatNum(ratio*100)}%`;
    }
  },
  { 
    title: "Percentage Difference", 
    slug: "percentage-difference",
    a: "Value A", b: "Value B", pa: "80", pb: "100",
    fn: (a, b) => { 
      if (a === 0 && b === 0) return "Both values are zero";
      const avg = (a + b) / 2;
      if (avg === 0) return "Cannot calculate percentage difference";
      const r = (Math.abs(a - b) / avg) * 100;
      return `The percentage difference between A and B is ${formatNum(r)}%`; 
    },
    explain: (a, b) => {
        if (a === 0 && b === 0) return "Both values are zero";
        const diff = Math.abs(a - b);
        const avg = (a + b) / 2;
        if(avg===0) return "Average is zero, cannot calculate.";
        const ratio = diff / avg;
        return `Step 1: Absolute Difference\n|${a} - ${b}| = ${formatNum(diff)}\n\nStep 2: Average\n(${a} + ${b}) ÷ 2 = ${formatNum(avg)}\n\nStep 3: Difference ÷ Average × 100\n${formatNum(diff)} ÷ ${formatNum(avg)} × 100 = ${formatNum(ratio * 100)}%`;
    }
  }
];

const grid = document.getElementById('grid');
const resetSvg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>';
const copySvg = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
const checkSvg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';

const fragment = document.createDocumentFragment();

calcs.forEach((c, index) => {
  const card = document.createElement('div');
  card.className = 'card';
  // TASK 7: Set ID for Hash Link
  card.id = c.slug;
  
  const idA = `calc-${index}-a`;
  const idB = `calc-${index}-b`;
  
  card.innerHTML = `
    <div class="card-header">
        <h2>${c.title}</h2>
        <button class="reset-btn" aria-label="Reset ${c.title}" title="Clear inputs and history">${resetSvg}</button>
    </div>
    <div class="card-body">
      <div class="field">
        <label for="${idA}">${c.a}</label>
        <input type="number" id="${idA}" placeholder="${c.pa}" data-input="a" step="any">
      </div>
      <div class="field">
        <label for="${idB}">${c.b}</label>
        <input type="number" id="${idB}" placeholder="${c.pb}" data-input="b" step="any">
      </div>
      <div class="result-wrapper">
        <div class="result empty" aria-live="polite">Result: —</div>
        <button class="copy-btn" aria-label="Copy result" title="Copy to clipboard">${copySvg}</button>
        <!-- TASK 4: Add Copy Number Button -->
        <button class="copy-number-btn" aria-label="Copy number only" title="Copy numeric result">#</button>
      </div>

      <!-- NEW: Explain Result -->
      <div class="explain-section">
         <button class="explain-btn" aria-expanded="false">[ Explain ]</button>
         <div class="explanation-box" aria-hidden="true"></div>
      </div>
      
      <!-- NEW: Try Example Section -->
      <div class="try-example">
        <span>Ex: ${c.pa} & ${c.pb}</span>
        <button class="try-btn" aria-label="Try example values">Try Example</button>
      </div>

      <details class="history">
        <summary>History</summary>
        <ul class="history-list"></ul>
      </details>
    </div>`;
    
  const inA = card.querySelector('[data-input="a"]');
  const inB = card.querySelector('[data-input="b"]');
  const res = card.querySelector('.result');
  const copyBtn = card.querySelector('.copy-btn');
  const copyNumberBtn = card.querySelector('.copy-number-btn'); // New Button Selection
  const histList = card.querySelector('.history-list');
  const tryBtn = card.querySelector('.try-btn');
  
  // Explain features
  const explainBtn = card.querySelector('.explain-btn');
  const explainBox = card.querySelector('.explanation-box');

  // NEW: Keyboard Power User Features
  card.addEventListener('keydown', (e) => {
    // 1. Esc to reset
    if (e.key === 'Escape') {
        const resetBtn = card.querySelector('.reset-btn');
        resetBtn.click();
        resetBtn.focus();
    }
    // 2. Ctrl/Cmd + C to copy result
    if ((e.ctrlKey || e.metaKey) && e.key === 'c') {
        if (!window.getSelection().toString()) {
            // Only copy result if user hasn't selected text manually
            e.preventDefault();
            copyBtn.click();
        }
    }
    // 3. Enter to Jump inputs
    if (e.key === 'Enter') {
        if (document.activeElement === inA) {
            e.preventDefault();
            inB.focus();
        } else if (document.activeElement === inB) {
            // Optional: Jump to next card? For now, just commit (blur or stay)
            // Default behavior handles commit via change event
        }
    }
  });

  // Explain Toggle Logic
  explainBtn.addEventListener('click', () => {
    const isVisible = explainBox.classList.contains('visible');
    if (isVisible) {
        explainBox.classList.remove('visible');
        explainBtn.setAttribute('aria-expanded', 'false');
    } else {
        explainBox.classList.add('visible');
        explainBtn.setAttribute('aria-expanded', 'true');
    }
  });

  const loadState = () => {
    const savedA = localStorage.getItem(`${STORE_KEY}${index}_a`);
    const savedB = localStorage.getItem(`${STORE_KEY}${index}_b`);
    const savedHist = JSON.parse(localStorage.getItem(`${STORE_KEY}${index}_hist`) || '[]');
    
    if (savedA) inA.value = savedA;
    if (savedB) inB.value = savedB;
    renderHistory(savedHist);
  };

  const renderHistory = (histArray) => {
    histList.innerHTML = histArray.length === 0 
      ? '<li style="color:var(--text-muted); font-style:italic;">No recent calculations</li>' 
      : histArray.map(item => `<li><span>${item.date}</span><span class="history-val">${item.val}</span></li>`).join('');
  };

  const saveHistory = (resultText) => {
    if (!resultText || resultText === 'Result: —' || resultText.includes('Cannot')) return;
    
    let hist = JSON.parse(localStorage.getItem(`${STORE_KEY}${index}_hist`) || '[]');
    if (hist.length > 0 && hist[0].val === resultText) return;

    hist.unshift({ val: resultText, date: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) });
    if (hist.length > 3) hist.pop();
    
    localStorage.setItem(`${STORE_KEY}${index}_hist`, JSON.stringify(hist));
    renderHistory(hist);
  };

  const update = (shouldSaveHistory = false) => {
    const valA = parseFloat(inA.value.trim());
    const valB = parseFloat(inB.value.trim());
    
    if (!isNaN(valA) && !isNaN(valB)) {
      const resultText = c.fn(valA, valB);
      
      if (res.textContent !== resultText) {
        res.textContent = resultText;
        res.className = 'result filled';
        res.classList.remove('updated');
        void res.offsetWidth; 
        res.classList.add('updated');
      }

      // Update Explanation
      explainBox.textContent = c.explain(valA, valB);
      explainBtn.style.display = 'block';

      localStorage.setItem(`${STORE_KEY}${index}_a`, inA.value);
      localStorage.setItem(`${STORE_KEY}${index}_b`, inB.value);

      if (shouldSaveHistory) saveHistory(resultText);

      // TASK 5: URL State Sharing Logic
      if (!userInteracted) userInteracted = true;

      if (userInteracted) {
        const params = new URLSearchParams();
        params.set('tool', index);
        params.set('a', valA);
        params.set('b', valB);
        history.replaceState(null, '', '?' + params.toString());
      }

    } else { 
      res.textContent = 'Result: —'; 
      res.className = 'result empty';
      explainBtn.style.display = 'none';
      explainBox.classList.remove('visible');
      if (inA.value === '') localStorage.removeItem(`${STORE_KEY}${index}_a`);
      if (inB.value === '') localStorage.removeItem(`${STORE_KEY}${index}_b`);
    }
  };
  
  inA.addEventListener('input', () => update(false));
  inB.addEventListener('input', () => update(false));
  
  const commit = () => update(true);
  inA.addEventListener('change', commit);
  inB.addEventListener('change', commit);
  // Keydown listeners moved to card level for centralized handling
  
  card.querySelector('.reset-btn').addEventListener('click', () => { 
    inA.value = ''; 
    inB.value = ''; 
    update(false);
    localStorage.removeItem(`${STORE_KEY}${index}_a`);
    localStorage.removeItem(`${STORE_KEY}${index}_b`);
    localStorage.removeItem(`${STORE_KEY}${index}_hist`);
    renderHistory([]);
    inA.focus(); 
  });

  copyBtn.addEventListener('click', () => {
    const text = res.textContent;
    if (text === 'Result: —') return;
    
    navigator.clipboard.writeText(text).then(() => {
      const originalSvg = copyBtn.innerHTML;
      copyBtn.innerHTML = checkSvg;
      copyBtn.style.color = 'var(--primary)';
      setTimeout(() => {
        copyBtn.innerHTML = originalSvg;
        copyBtn.style.color = '';
      }, 1500);
    });
  });

  // TASK 4: Copy Number Only Logic
  copyNumberBtn.addEventListener('click', () => {
    const text = res.textContent;
    const match = text.match(/-?\d+(\.\d+)?/g);
    if (!match) return;
    const lastNumber = match[match.length - 1];
    navigator.clipboard.writeText(lastNumber);
  });

  // NEW: Try Example Button Logic
  tryBtn.addEventListener('click', () => {
    inA.value = c.pa;
    inB.value = c.pb;
    update(true); // Trigger update AND save to history
  });
  
  loadState();
  if (inA.value && inB.value) update(false);

  fragment.appendChild(card);
});

// TASK 6: Load from URL Params
const params = new URLSearchParams(window.location.search);
const toolIndex = params.get('tool');
const aVal = params.get('a');
const bVal = params.get('b');

if (toolIndex !== null && calcs[toolIndex]) {
  setTimeout(() => {
    const card = grid.children[toolIndex];
    if (!card) return;

    const inA = card.querySelector('[data-input="a"]');
    const inB = card.querySelector('[data-input="b"]');

    if (aVal) inA.value = aVal;
    if (bVal) inB.value = bVal;

    userInteracted = true;
    inA.dispatchEvent(new Event('input'));
  }, 50);
}

grid.appendChild(fragment);

// V3: Native Share Logic
document.getElementById('shareBtn').addEventListener('click', async () => {
  if (navigator.share) {
    try {
      await navigator.share({
        title: document.title,
        text: 'Check out this free online Percentage Calculator.',
        url: window.location.href
      });
    } catch (err) {
      // User cancelled or share failed
    }
  } else {
    // Fallback: Copy URL
    navigator.clipboard.writeText(window.location.href).then(() => {
      const btn = document.getElementById('shareBtn');
      const originalText = btn.innerHTML; // Store original content (icon + text)
      // Temporarily change content to text only for feedback
      btn.innerHTML = '<span style="width:100%; text-align:center;">Copied!</span>';
      setTimeout(() => {
         btn.innerHTML = originalText;
      }, 2000);
    });
  }
});

// TASK 8: Scroll to Hash
if (window.location.hash) {
  const target = document.querySelector(window.location.hash);
  if (target) {
    setTimeout(() => {
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 100);
  }
}
</script>
</body>
</html>
